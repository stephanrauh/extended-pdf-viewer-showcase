<div class="flex-container-column fill-container">
  @if (!(fullscreenService.isFullscreen$ | async)) {
    <div class="flex-container-row">
      <div class="bg-white border border-gray-300 rounded-lg shadow-mat-8 p-6 mt-1 flex-1 box-border max-w-[55%]">
        <div class="w-full">
          <!-- Tab buttons -->
          <div class="overflow-x-auto">
            <div class="flex space-x-2 w-max border-b border-gray-200 mb-2">
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="exportannotationscomponentTab === 'livedemo'"
                [class.border-primary-600]="exportannotationscomponentTab === 'livedemo'"
                [class.text-gray-500]="exportannotationscomponentTab !== 'livedemo'"
                [class.border-transparent]="exportannotationscomponentTab !== 'livedemo'"
                (click)="exportannotationscomponentTab = 'livedemo'"
              >
                live demo
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="exportannotationscomponentTab === 'forms'"
                [class.border-primary-600]="exportannotationscomponentTab === 'forms'"
                [class.text-gray-500]="exportannotationscomponentTab !== 'forms'"
                [class.border-transparent]="exportannotationscomponentTab !== 'forms'"
                (click)="exportannotationscomponentTab = 'forms'"
              >
                forms
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="exportannotationscomponentTab === 'largefiles'"
                [class.border-primary-600]="exportannotationscomponentTab === 'largefiles'"
                [class.text-gray-500]="exportannotationscomponentTab !== 'largefiles'"
                [class.border-transparent]="exportannotationscomponentTab !== 'largefiles'"
                (click)="exportannotationscomponentTab = 'largefiles'"
              >
                large files
              </button>
            </div>
          </div>

          <!-- Tab content -->
          @if (exportannotationscomponentTab === 'livedemo') {
            <div class="tab-content">
              <p>
                You can export text, drawings, images, and highlights you've added to a PDF file. You can also add texts, highlights, and ink drawings programmatically.
                As for images, that's supported, but using the <a href="./annotation-layer-api">high-level different API</a>.
              </p>
              <p>
                <b>Frequent breaking changes:</b> This API relies on a rapidly evolving internal pdf.js data structure. Every once in a while,
                this results in a breaking change. I try to avoid that - but it happened twice now. At the time being, please be aware that this
                API may break at any time without notice when I update the base library, pdf.js. The latest breaking change is
                version 25.6.0, which fixes the ink editor export. Please bear with me! I'm sure the API will become stable in future.
                But we're not there yet.
              </p>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="exportAnnotations()">
                Export annotations
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="addTextEditor()">
                Add text editor
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="addHighlight()">
                Add highlight (currently broken)
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="addDrawing()">
                Add ink drawing
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="removeEditors()">
                Remove editors
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="removeTextEditors()">
                Remove text editors from page 1
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow mb-1 me-1" (click)="removeDrawingEditors()">
                Remove drawings from page 1
              </button>
            </div>
          }
          @if (exportannotationscomponentTab === 'forms') {
            <div class="tab-content">
              <p>
                Both forms and editor annotations are PDF annotation, so it might happen the APIs get in the way of each other. Until version 19.6.6, clicking
                "remove editors" would also remove the form fields. This has been fixed in version 19.6.7.
              </p>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="exportAnnotations()">
                Export annotations
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="addTextEditor()">
                Add text editor
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="addHighlight()">
                Add highlight (currently broken)
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="addDrawing()">
                Add ink drawing
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="removeEditors()">
                Remove editors
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="removeTextEditors()">
                Remove text editors from page 1
              </button>
              <button class="bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded shadow" (click)="removeDrawingEditors()">
                Remove drawings from page 1
              </button>
            </div>
          }
          @if (exportannotationscomponentTab === 'largefiles') {
            <div class="tab-content">
              <p>
                The PDF viewer renders pages lazily. If they aren't going to be used soon, the page is not rendered. If you've got a large file, a major part of
                the pages are just placeholders.
              </p>
              <p>
                This, in turn, means you can't add an annotation. If you want to add annotations to large files reliably, catch the event
                <code>(annotationLayerRendered)</code> and add the annotations in the event handler. Not that this event is triggered for every page
                individually. The event handler should add the annotations that belong to this particular page, but not to other pages.
              </p>
            </div>
          }
        </div>
      </div>
      <div class="bg-white border border-gray-300 rounded-lg shadow-mat-8 p-6 mt-1 flex-1 box-border max-w-[43%]">
        <div class="w-full">
          <!-- Tab buttons -->
          <div class="overflow-x-auto">
            <div class="flex space-x-2 w-max border-b border-gray-200 mb-2">
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'htmltemplate'"
                [class.border-primary-600]="codeTab === 'htmltemplate'"
                [class.text-gray-500]="codeTab !== 'htmltemplate'"
                [class.border-transparent]="codeTab !== 'htmltemplate'"
                (click)="codeTab = 'htmltemplate'"
              >
                HTML template
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'tstext'"
                [class.border-primary-600]="codeTab === 'tstext'"
                [class.text-gray-500]="codeTab !== 'tstext'"
                [class.border-transparent]="codeTab !== 'tstext'"
                (click)="codeTab = 'tstext'"
              >
                TS - text
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'tsdrawing'"
                [class.border-primary-600]="codeTab === 'tsdrawing'"
                [class.text-gray-500]="codeTab !== 'tsdrawing'"
                [class.border-transparent]="codeTab !== 'tsdrawing'"
                (click)="codeTab = 'tsdrawing'"
              >
                TS - drawing
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'tsremovingeditors'"
                [class.border-primary-600]="codeTab === 'tsremovingeditors'"
                [class.text-gray-500]="codeTab !== 'tsremovingeditors'"
                [class.border-transparent]="codeTab !== 'tsremovingeditors'"
                (click)="codeTab = 'tsremovingeditors'"
              >
                TS - removing editors
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'tsexporting'"
                [class.border-primary-600]="codeTab === 'tsexporting'"
                [class.text-gray-500]="codeTab !== 'tsexporting'"
                [class.border-transparent]="codeTab !== 'tsexporting'"
                (click)="codeTab = 'tsexporting'"
              >
                TS - exporting
              </button>
              <button
                class="px-3 py-1.5 text-xs font-medium border-b-2 focus:outline-none"
                [class.text-primary-600]="codeTab === 'livedemo'"
                [class.border-primary-600]="codeTab === 'livedemo'"
                [class.text-gray-500]="codeTab !== 'livedemo'"
                [class.border-transparent]="codeTab !== 'livedemo'"
                (click)="codeTab = 'livedemo'"
              >
                live demo
              </button>
            </div>
          </div>
          </div>

          <!-- Tab content -->
          @if (codeTab === 'htmltemplate') {
            <div class="tab-content">
              <app-ie11-markdown src="/assets/extended-pdf-viewer/export-annotations/html.md"> </app-ie11-markdown>
            </div>
          }
          @if (codeTab === 'tstext') {
            <div class="tab-content">
              <app-ie11-markdown src="/assets/extended-pdf-viewer/export-annotations/ts - add text.md"> </app-ie11-markdown>
            </div>
          }
          @if (codeTab === 'tsdrawing') {
            <div class="tab-content">
              <app-ie11-markdown src="/assets/extended-pdf-viewer/export-annotations/ts - add drawing.md"> </app-ie11-markdown>
            </div>
          }
          @if (codeTab === 'tsremovingeditors') {
            <div class="tab-content">
              <app-ie11-markdown src="/assets/extended-pdf-viewer/export-annotations/ts - removing.md"> </app-ie11-markdown>
            </div>
          }
          @if (codeTab === 'tsexporting') {
            <div class="tab-content">
              <app-ie11-markdown src="/assets/extended-pdf-viewer/export-annotations/ts - export.md"> </app-ie11-markdown>
            </div>
          }
          @if (codeTab === 'livedemo') {
            <div class="tab-content">
              <div class="mt-3">
                @if (rawAnnotations) {
                  <div>
                    <p>You can edit the annotations. Click outside the text areas to trigger rendering.</p>
                    @for (anno of rawAnnotations; track anno; let i = $index) {
                      <ol>
                        <li>
                          <textarea
                            [value]="rawAnnotations[i] | json"
                            (change)="updateAnnotation(i, $event)"
                            (input)="adjustSize($event)"
                            rows="{{ countRows(rawAnnotations[i] | json) }}"
                            cols="60"
                          ></textarea>
                        </li>
                      </ol>
                    }
                  </div>
                }
                @if (!rawAnnotations) {
                  <div>No annotations. Use the editor or the buttons to add text or drawings to the PDF file.</div>
                }
              </div>
            </div>
          }
        </div>
    </div>
  }

  <app-demo [src]="src">
    <ngx-extended-pdf-viewer [src]="src" [textLayer]="true" [showHandToolButton]="true" [handTool]="false"
      [theme]="theme"> </ngx-extended-pdf-viewer>
  </app-demo>
</div>
